<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>I: Basics – EDH 7916</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./apple-touch-icon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0ec6211309129a110f55943800a981fd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="site-attachments/styles.css">
<meta property="og:title" content="I: Basics – EDH 7916">
<meta property="og:image" content="https://capaldi.info/7916/apple-touch-icon.png">
<meta property="og:site_name" content="EDH 7916">
<meta property="og:image:height" content="180">
<meta property="og:image:width" content="180">
<meta name="twitter:title" content="I: Basics – EDH 7916">
<meta name="twitter:image" content="https://capaldi.info/7916/apple-touch-icon.png">
<meta name="twitter:image-height" content="180">
<meta name="twitter:image-width" content="180">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-viz-i.html">Data Visualization</a></li><li class="breadcrumb-item"><a href="./05-viz-i.html">I: Basics</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">EDH 7916</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homepage</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-set-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">I: Installing R &amp; RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-set-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II: Reading Data &amp; IPEDS</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-wrangle-i.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">I: Enter the tidyverse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-wrangle-ii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II: Appending, joining, &amp; reshaping data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-wrangle-iii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">III: Working with strings &amp; dates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-wrangle-iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IV: Advanced `tidyverse` &amp; Data Retrieval</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-viz-i.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">I: Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-viz-ii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II: Customization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-viz-iii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">III: Maps &amp; Spatial Data (Feat. APIs)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-quarto-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reproducible Reports with Quarto</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-pro-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Functions &amp; Loops</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-pro-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bringing it All Together (Feat. Basic Models)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Extra Credit</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-01-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">I: Git &amp; GitHub</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-02-dload-ipeds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II: Automating Data Retrieval in Reproducible Report</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-03-vanilla.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">III: Data Wrangling I Redux: Vanilla R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-04-scrape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IV: Web Scraping</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-viz-i.html">Data Visualization</a></li><li class="breadcrumb-item"><a href="./05-viz-i.html">I: Basics</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">I: Basics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Lesson</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Assignment</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><a href="./r-scripts/05-viz-i.R"><i class="fa-solid fa-code" aria-label="code"></i> R Code</a></p>
<section id="progress-check-in" class="level2">
<h2 data-anchor-id="progress-check-in">Progress Check-In</h2>
<ul>
<li>In keeping with the theme of today’s lesson, we made a little plot that represents roughly the breakdown of “core R content” covered in each lesson (as in, the basic knowledge you need to go off and do your own data work)
<ul>
<li>Congratulations, after the first two data-wrangling lessons, you’re already half-way done!</li>
<li>Over the next three weeks, we will cover how to communicate the results of these basic skills using visualization with <code>ggplot2</code> and report generation with <code>quarto</code></li>
<li>Then, we will get into the final series of lessons, each of which gives you a little taste of some more sophisticated and/or niche applications of R</li>
<li>Throughout all this, we will continue to become familiar with the basics of data wrangling, as that really is the key to it all</li>
</ul></li>
<li>Any questions or concerns?</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="setup" class="level2">
<h2 data-anchor-id="setup">Setup</h2>
<ul>
<li>One key part of understanding your data and presenting your analyses lies in making plots, which we will cover through this section of the class</li>
</ul>
<section id="choosing-a-plot" class="level4">
<h4 data-anchor-id="choosing-a-plot">Choosing a Plot</h4>
<ul>
<li><p>The main problem does not lie in the creation of a chart. R can do (almost) any chart you can dream up. The diffculty consists in thinking hard about what is it that you want to show to the reader. What is your message? What do you want to show?</p>
<ul>
<li>What types of variables do we want to visualize?</li>
<li>How many variables?</li>
</ul></li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"># variables</th>
<th style="text-align: center;">Type of variables</th>
<th style="text-align: center;">Plot type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">One</td>
<td style="text-align: center;">Categorical</td>
<td style="text-align: center;">bar chart</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Continuous</td>
<td style="text-align: center;">histogram</td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">density plot</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">box plot</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Two</td>
<td style="text-align: center;">Cat - Cat</td>
<td style="text-align: center;">grouped bar chart</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Cat - Con</td>
<td style="text-align: center;">grouped box plot</td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;">Con - Con</td>
<td style="text-align: center;">scatterplot</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">line plot</td>
</tr>
</tbody>
</table>
<ul>
<li><p>Many more graphs. Feel free to explore <a href="https://r-graph-gallery.com/">R graph gallery</a>.</p></li>
<li><p>There are multiple graphing systems in R, but we are going to focus on two (primarily one);</p>
<ul>
<li><a href="https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/00Index.html">base R plots</a></li>
<li><a href="http://ggplot2.tidyverse.org">ggplot2</a></li>
</ul></li>
</ul>
</section>
<section id="base-r-plots" class="level4">
<h4 data-anchor-id="base-r-plots">Base R Plots</h4>
<ul>
<li>Base R (i.e., R without any packages loaded) can create some basic plots
<ul>
<li>They aren’t the prettiest, so we wouldn’t recommend them in reports and papers
<ul>
<li>But, they’re super-easy and quick to create, so they’re perfect for quickly checking your data during the exploration phase</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="ggplot2-plots" class="level4">
<h4 data-anchor-id="ggplot2-plots"><code>ggplot2</code> Plots</h4>
<ul>
<li><code>ggplot</code> or <code>ggplot2</code> (ggplot was originally a different library, but doesn’t exist anymore)</li>
<li>The gg stands for <a href="http://vita.had.co.nz/papers/layered-grammar.html">grammar of graphics</a>
<ul>
<li>This is a whole world of detail to dive into if you want</li>
<li>The basic idea is that the graphs are made up of <em>layers</em>
<ul>
<li>This allows us to create some really cool and detailed plots
<ul>
<li>Strongly recommend <code>ggplot2</code> for making plots you want to share
<ul>
<li>Even stata users admit the plots can’t match <code>ggplot2</code></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="libraries" class="level3">
<h3 data-anchor-id="libraries">Libraries</h3>
<ul>
<li><p>We’re using two libraries today (plus the base R plot functions)</p></li>
<li><p><a href="http://ggplot2.tidyverse.org">ggplot2</a></p></li>
<li><p>The <a href="http://ggplot2.tidyverse.org">ggplot2</a> library is part of the <code>tidyverse</code></p>
<ul>
<li>We don’t need to load it separately (we can just use <code>library(tidyverse)</code> as always)</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##' [Libraries]</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We’re also going to use <a href="http://haven.tidyverse.org">haven</a>,</li>
<li>Haven allows us to read in data files from other software such as SPSS, SAS, and Stata
<ul>
<li>We’ll use it to read in a Stata (<code>*.dta</code>) version of the small HSLS data we’ve used before
<ul>
<li>The Stata version, unlike the plain <code>.csv</code> version, has labels for the variables and values, which will be useful when plotting</li>
</ul></li>
</ul></li>
<li>Haven is also part of the <code>tidyverse</code> but not loaded by default</li>
<li>We could load the package with <code>library(haven)</code>, but, if we only need one function from a package, it’s often easier to call it directly (plus this is useful trick to know)
<ul>
<li><code>library(&lt;package&gt;)</code> pre-loads all the functions so that we can easily call them with just the function name</li>
<li>If you only need one function from a package, or, you want to use a function from a package with a conflict (i.e., two packages with functions with the same name) we can specify where the function should come from like this
<ul>
<li><code>&lt;package&gt;::&lt;function&gt;</code></li>
<li>I.e., <code>haven::read_dta()</code></li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">##' [Input data]</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">## read_dta() ==&gt; read in Stata (*.dta) files</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>data_hs <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">"data/hsls-small.dta"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="do">## read_csv() ==&gt; read in comma separated value (*.csv) files</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/sch-test/all-schools.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p><strong>Note</strong> that since we have two data files this lesson, we gave them unique names instead of the normal <code>data</code>:</p></li>
<li><p><code>data_hs</code> := <code>hsls-small.dta</code></p></li>
<li><p><code>data_ts</code> := <code>all-schools.csv</code></p></li>
</ul>
</section>
</section>
<section id="plots-using-base-r" class="level2">
<h2 data-anchor-id="plots-using-base-r">Plots using base R</h2>
<ul>
<li>Even though new graphics libraries have been developed, the base R graphics system remains powerful</li>
<li>The base system is also very easy to use in a pinch
<ul>
<li>Good for a quick visual of a data distribution that’s just for ourselves</li>
</ul></li>
<li><strong>Note</strong> that for the next few plots, let’s not worry too much about how they look
<ul>
<li>Specifically, the axis labels won’t look very nice</li>
</ul></li>
<li><strong>Also note</strong> that we’ll have to switch to using the base R data frame <code>$</code> notation to pull out the columns we want
<ul>
<li>In short, to reference a column in a data frame in base R, you say <code>dataframe$column</code></li>
<li>If you need some more information on using <code>$</code> notation, <a href="./x-03-vanilla.html">check out the supplemental lesson on data wrangling with base R</a>.</li>
</ul></li>
</ul>
<section id="histogram" class="level3">
<h3 data-anchor-id="histogram">Histogram</h3>
<ul>
<li>For continuous variables, a histogram is a useful plot</li>
<li>Though the <code>hist()</code> function has many options to adjust how it looks
<ul>
<li>The default settings work really well if you just want a quick look at the distribution.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram of math scores (which should be normal by design)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(data_hs<span class="sc">$</span>x1txmtscor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_base_histogram-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<h4 id="quick-exercise">Quick exercise</h4>
<p>Check the distribution of the students’ socioeconomic score (SES).</p>
</blockquote>
</section>
<section id="density" class="level3">
<h3 data-anchor-id="density">Density</h3>
<ul>
<li>Density plots are also really helpful for checking the distribution of a variable</li>
<li>Base R doesn’t have formal density plot function, but you can get a density plot with a trick
<ul>
<li><code>plot()</code> the <code>density()</code> of a continuous variable</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p>Quick question: What does the <code>na.rm = TRUE</code> and why might we need it?</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## density plot of math scores</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">density</span>(data_hs<span class="sc">$</span>x1txmtscor, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_base_density-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<h4 id="quick-exercise-1">Quick exercise</h4>
<p>First, plot the density of SES Then, add the <code>col</code> argument in <code>plot()</code> to change the color of the line to <code>"red"</code></p>
</blockquote>
</section>
<section id="box-plot" class="level3">
<h3 data-anchor-id="box-plot">Box plot</h3>
<ul>
<li>A box plot will let you see the distribution of a continuous variable at specific values of a categorical variable
<ul>
<li>For example, test scores ranges at each student expectation level</li>
</ul></li>
<li>Call a box plot using the <code>boxplot()</code> function
<ul>
<li>This one is a little trickier because it uses the <a href="https://www.statmethods.net/graphs/boxplot.html">R formula</a> construction to set the continuous variable against the discrete variable</li>
<li>The formula uses a tilde, <code>~</code>, and should be constructed like this:
<ul>
<li><code>&lt;continuous var&gt; ~ &lt;discrete var&gt;</code></li>
<li>We will talk in more detail about formulas in the <a href="./12-pro-model.html">Programming: Modeling Basics lesson</a></li>
</ul></li>
<li>As we are using a formula, notice how we can use the <code>data = data_hs</code> argument instead of adding <code>data_hs$</code> in front of the variable names, which saves some typing</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## box plot of math scores against student expectations</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(x1txmtscor <span class="sc">~</span> x1stuedexpct, <span class="at">data =</span> data_hs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_base_box-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the boxplot, we can see that math test scores tend to increase as students’ educational expectations increase (remember that 11 means “I don’t know [how far I’ll go in school]”), though there’s quite a bit of overlap in the marginal distributions.</p>
</section>
<section id="scatterplot" class="level3">
<h3 data-anchor-id="scatterplot">Scatterplot</h3>
<ul>
<li>Plot two continuous variables against one another using the base <code>plot()</code> function</li>
<li>The main way to make a scatter plot is <code>plot(x, y)</code>
<ul>
<li>The <code>x</code> is the variable that will go on the x-axis and <code>y</code> the one that will go on the y-axis</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## scatter plot of math against SES</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data_hs<span class="sc">$</span>x1ses, data_hs<span class="sc">$</span>x1txmtscor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_base_scatter-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the scatter plot we see the data seem to show a positive correlation between socioeconomic status and math test score, there’s also quite a bit of variation in that association (notice that the cloud-like nature of the circles).</p>
<blockquote class="blockquote">
<h4 id="quick-exercise-2">Quick exercise</h4>
<p>Rerun the above plot, but this time store it in an object, <code>plot_1</code>, then get the plot to print out</p>
</blockquote>
</section>
</section>
<section id="plots-using-ggplot2" class="level2">
<h2 data-anchor-id="plots-using-ggplot2">Plots using <code>ggplot2</code></h2>
<ul>
<li><code>ggplot2</code> is R users’ primary system for making plots</li>
<li>It is based on the idea of a <a href="https://www.springer.com/gp/book/9780387245447">grammar of graphics</a>
<ul>
<li>Just as we can use finite rules of a language grammar to construct an endless number of unique sentences, so too can we use a few graphical grammatical rules to make an endless number of unique figures.</li>
</ul></li>
<li>The <a href="http://ggplot2.tidyverse.org/reference/">ggplot2 system</a> is too involved to cover in all of its details
<ul>
<li>But that’s kind of the point of the grammar of graphics</li>
<li>Once you see how it’s put together, you can anticipate the commands you need to build your plot.</li>
</ul></li>
<li>We’ll start by covering the same plots as above.</li>
</ul>
<section id="histogram-1" class="level3">
<h3 data-anchor-id="histogram-1">Histogram</h3>
<p><a href="http://ggplot2.tidyverse.org">As the main help site says</a>, all ggplot2 plots need three things:</p>
<ul>
<li><p><strong>[data]</strong>: The source of the variables you want to plot</p></li>
<li><p><strong>[aesthetics]</strong>: How variables in the data map onto the plot (<em>e.g.</em>, what’s on the x-axis? what’s on the y-axis?)</p></li>
<li><p><strong>[geom]</strong>: The geometry of the figure or the kind of figure you want to make (<em>e.g.</em>, what do you want to <strong>do</strong> with those data and mappings? A line graph? A box plot?…)</p></li>
<li><p>We’ll start by making a histogram again</p></li>
<li><p>To help make these pieces clearer, I’ll use the argument names when possible</p>
<ul>
<li>As you become familiar, you probably will stop naming some of these core arguments</li>
</ul></li>
<li><p>The first function, which initializes the plot is <code>ggplot()</code></p>
<ul>
<li>Its first argument is the data, which want to use <code>data_hs</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## init ggplot </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_histogram_blank-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>…nothing! Well, not nothing, but no histogram.
<ul>
<li>That’s because the plot knows the data but doesn’t know what do with it. What do we want?</li>
</ul></li>
<li>Since we want a histogram, we add the <code>geom_histogram()</code> function to the existing plot object with a plus sign(<code>+</code>). Once we do that, we’ll try to print the plot again…</li>
<li>The aesthetic mappings, that is, which variables go where or how they function on the plot, go inside the <code>aes()</code> function.
<ul>
<li>Since we only have one variable, <code>x1txmtscor</code>, it is assigned to <code>x</code>.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## add histogram instruction (notice we can add pieces using +)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_histogram-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Success!</p>
<blockquote class="blockquote">
<p>Quick excercise: try assigning the historgram to an object, then getting it to print out</p>
</blockquote>
<ul>
<li>As you can see, the code to make a ggplot2 figure looks a lot like what we’ve seen with other tidyverse libraries, <em>e.g.</em> dplyr.</li>
<li>The key difference between ggplot2 and our previous code, however, is that
<ul>
<li>Up to now we have used the pipe (<code>|&gt;</code>) to pass output to the next function</li>
<li>ggplot2 uses a plus sign (<code>+</code>) add new layers to the plot</li>
</ul></li>
<li>Layers is exactly how you want to think about ggplots
<ul>
<li>The <code>ggplot()</code> is the base layer of the graph
<ul>
<li>Anything you place in here will become the default for every other layer
<ul>
<li>For example, if we say <code>data = data</code> in <code>ggplot()</code>, that will be the default data for every layer
<ul>
<li>Generally we will specify the data here, and <code>mapping = aes()</code> in the specific plots</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p>Quick question(s): Why might that make sense? Which is more likely to change? Are there times you might want to set an aesthetic for the whole plot?</p>
</blockquote>
</section>
<section id="density-1" class="level3">
<h3 data-anchor-id="density-1">Density</h3>
<ul>
<li>Unlike the base R graphics system, ggplot2 does have a density plotting command <code>geom_density()</code>
<ul>
<li>The rest of the code remains the same as for <code>geom_histogram()</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## density</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_density-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<h4 id="quick-exercise-3">Quick exercise</h4>
<p>If we wanted to see the histogram and density plot on top of each other, what might we do? Give it a go, and, tell me why it didn’t work…</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The issue is that the histogram y scale is much much larger than the density
<ul>
<li>To fix that, let’s modify the <code>geom_histogram()</code> aesthetic to use the <code>density</code> function rather than the raw counts
<ul>
<li>We use the <code>after_stat()</code> function, which basically means after ggplot calculates the statistics, it converts them to density</li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram with density plot overlapping</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor, <span class="at">y =</span> <span class="fu">after_stat</span>(density))) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_histdens-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>It worked, but it’s not the greatest visual since the colors are the same and the density plot is thin with no fill.</p></li>
<li><p>Adding to what came before, the <code>geom_histogram()</code> and <code>geom_density()</code> both take on new arguments that change the defaults</p></li>
<li><p>Now the resulting plot should look nicer and be easier to read</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram with density plot overlapping (add color to see better)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor, <span class="at">y =</span> <span class="fu">after_stat</span>(density)),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"red"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_histdens_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<h4 id="quick-exercise-4">Quick exercise</h4>
<p>Try changing some of the arguments in the last plot. What happens when you change <code>alpha</code> (keep the value between 0 and 1)? What does the <code>color</code> argument change? And <code>fill</code>? What happens if you switch the <code>geom_*()</code> functions, call <code>geom_histogram()</code> after you call <code>geom_density()</code>?</p>
</blockquote>
<ul>
<li>A critical thing to note, in the previous plot <code>color</code>, <code>fill</code>, and <code>alpha</code> were all outside the <code>aes()</code>
<ul>
<li>This means they take a single value and apply it uniformly, it should portray no information and just change the appearance</li>
<li>To use these elements to portray information, we need to place the arguments inside <code>aes()</code> like we will do in the next plot</li>
</ul></li>
</ul>
</section>
<section id="two-way" class="level3">
<h3 data-anchor-id="two-way">Two-way</h3>
<ul>
<li><p>Plotting the difference in a continuous distribution across groups is a common task</p></li>
<li><p>Let’s see the difference between student math scores between students with parents who have any postsecondary degree and those without.</p></li>
<li><p>Since we’re using data that was labeled in Stata, we’ll see the labels when we use <code>count()</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## see the counts for each group</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data_hs <span class="sc">|&gt;</span> <span class="fu">count</span>(x1paredu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  x1paredu                                         n
  &lt;dbl+lbl&gt;                                    &lt;int&gt;
1  1 [Less than high school]                    1010
2  2 [High school diploma or GED]               5909
3  3 [Associate's degree]                       2549
4  4 [Bachelor's degree]                        4102
5  5 [Master's degree]                          2116
6  7 [Ph.D/M.D/Law/other high lvl prof degree]  1096
7 NA                                            6721</code></pre>
</div>
</div>
<ul>
<li>We can see that all values of <code>x1paredu</code> greater than 2 represent parents with some college credential
<ul>
<li>Since we want only two distinct groups, we can use <code>mutate</code>, <code>ifelse</code> and the operator <code>&gt;=</code> to make a new 0/1 binary variable. - If a value of <code>x1paredu</code> is above 3, then the new indicator <code>pared_coll</code> will be 1; if not, 0.</li>
</ul></li>
</ul>
<p><strong>NOTE</strong> that in the Stata version of <code>hsls_small</code>, all the missing values, which are normally negative numbers, have already been properly converted to <code>NA</code> values. That’s why we see a count column for <code>NA</code> and not labels for missingness that we might have expected based on prior lessons.</p>
<ul>
<li><p>The <code>ggplot()</code> function doesn’t need to use our full data</p></li>
<li><p>In fact, our data needs to be set up a bit differently to make this plot</p>
<ul>
<li>This is a common thing people forget when plotting, data wrangling lessons <a href="./03-wrangle-i.html">one</a> and <a href="./04-wrangle-ii.html">two</a> are your friend here</li>
</ul></li>
<li><p>We’ll make a new temporary data object that only has the data we need.</p></li>
<li><p>Notice, after we create <code>pared_coll</code>, we use the <code>factor()</code> command to make it a factor type of variable</p>
<ul>
<li>This is R’s built in way of handling categorical variables (i.e., so that is doesn’t think it’s continuous)</li>
<li>Creating factors is really useful for plotting, and later on for statistical models</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## need to set up data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> data_hs <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## select the columns we need</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x1paredu, x1txmtscor) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## can't plot NA so will drop</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create new variable that == 1 if parents have any college, then make it a factor</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pared_coll =</span> <span class="fu">ifelse</span>(x1paredu <span class="sc">&gt;=</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">pared_coll =</span> <span class="fu">factor</span>(pared_coll)) <span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## drop (using negative sign) the original variable we don't need now</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>x1paredu) </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="do">## show</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  x1txmtscor pared_coll
  &lt;dbl+lbl&gt;  &lt;fct&gt;     
1 59.4       1         
2 47.7       1         
3 64.2       1         
4 49.3       1         
5 62.6       1         
6 58.1       1         </code></pre>
</div>
</div>
<ul>
<li>To plot against the two groups we’ve made, we need to add it to the aesthetic feature, <code>aes()</code></li>
<li>The math score, <code>x1txmtscor</code>, is still mapped to <code>x</code></li>
<li>Since we want two side-by-side histograms, we set the <code>fill</code> aesthetic to our new indicator variable</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## two way histogram</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> pared_coll),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_histogram_double-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>By assigning <code>pared_coll</code> to the <code>fill</code> aesthetic, we can see a difference in the distribution of math test scores between students whose parents have at least some college and those whose parents do not
<ul>
<li>Note: there are more students with no parental college education, so that whole histogram is bigger
<ul>
<li>If we want to compare the shape of distribution more easily, we should use <code>geom_density()</code></li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## two way density</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1txmtscor,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> pared_coll),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_histogram_double_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<h4 id="quick-question">Quick question</h4>
<p>Why does the <code>color = "black"</code> not mean we have two black density/histogram plots? What happens if you remove it? Can you make it <code>&lt;something else&gt; = "black"</code> to get rid of the colors?</p>
</blockquote>
</section>
<section id="box-plot-1" class="level3">
<h3 data-anchor-id="box-plot-1">Box plot</h3>
<ul>
<li>By this point, you’re hopefully seeing the pattern in how ggplot2 figures are put together</li>
<li>To make a box plot, we need to add a <code>y</code> mapping to the <code>aes()</code> in addition to the <code>x</code> mapping</li>
<li>We’ve also added the same variable to <code>fill</code> as we did to <code>x</code>
<ul>
<li>We do this so that in addition to having different box and whisker plots along the x-axis, each plot is given its own color</li>
</ul></li>
<li>Notice: this time, we just threw <code>factor()</code> around the variable in the plot, rather than using mutate to change the data</li>
</ul>
<blockquote class="blockquote">
<p>Quick question: What do you think the pros and cons of using <code>factor()</code> in the plot over mutating the data might be?</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## box plot using both factor() and as_factor()</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(x1paredu),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> x1txmtscor,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> <span class="fu">factor</span>(x1paredu))) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_box-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>In a way, this plot is similar to the dual histogram above
<ul>
<li>But since we want to see the distribution of math scores across finer-grained levels of parental education, the box and whisker plot is clearer than trying to overlap seven histograms.</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<h4 id="quick-exercise-5">Quick exercise</h4>
<p>We will get more into making things look pretty in <a href="./06-viz-ii.html">Data Vizualization II</a>, but, what is a real problem with this graph? Does it even need to be there?</p>
</blockquote>
</section>
<section id="scatterplot-1" class="level3">
<h3 data-anchor-id="scatterplot-1">Scatterplot</h3>
<ul>
<li>To make a scatter plot, make sure that the <code>aes()</code> has mappings for the <code>x</code> axis and <code>y</code> axis and then use <code>geom_point()</code> to plot.</li>
<li>To make things easier to see (remembering the over-crowded cloud from the base R plot above), we’ll reduce the data to 10% of the full sample using <code>sample_frac()</code> from dplyr</li>
<li>We’ll also limit our 10% to those who aren’t missing information about student education expectations</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## sample 10% to make figure clearer</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>data_hs_10 <span class="ot">&lt;-</span> data_hs <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## drop observations with missing values for x1stuedexpct</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(x1stuedexpct) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## sample</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="fl">0.1</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="do">## scatter</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs_10) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1ses, <span class="at">y =</span> x1txmtscor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_scatter_1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Now that we have our scatter plot, let’s say that we want to add a third dimension
<ul>
<li>Specifically, we want to change the color of each point based on whether a student plans to earn a Bachelor’s degree or higher
<ul>
<li>That means we need a new dummy variable that is 1 for those with BA/BS plans and 0 for others.</li>
</ul></li>
</ul></li>
</ul>
<p>We can look at the student base year expectations with <code>count()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## see student base year plans</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>data_hs <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(x1stuedexpct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   x1stuedexpct                                     n
   &lt;dbl+lbl&gt;                                    &lt;int&gt;
 1  1 [Less than high school]                      93
 2  2 [High school diploma or GED]               2619
 3  3 [Start an Associate's degree]               140
 4  4 [Complete an Associate's degree]           1195
 5  5 [Start a Bachelor's degree]                 115
 6  6 [Complete a Bachelor's degree]             3505
 7  7 [Start a Master's degree]                   231
 8  8 [Complete a Master's degree]               4278
 9  9 [Start Ph.D/M.D/Law/other prof degree]      176
10 10 [Complete Ph.D/M.D/Law/other prof degree]  4461
11 11 [Don't know]                               4631
12 NA                                            2059</code></pre>
</div>
</div>
<ul>
<li>We see that <code>x1stuedexpct &gt;= 6</code> means a student plans to earn a Bachelor’s degree or higher.</li>
<li>But since we need to account for the fact that 11 means “I don’t know”, we need to make sure our test includes <code>x1stuedexpct &lt; 11</code></li>
<li>Remember from a prior lesson that we can connect these two statements together with the operator <code>&amp;</code></li>
<li>Let’s create our new variable
<ul>
<li>Notice this time when we create the factor, we specify <code>levels</code> and <code>labels</code>
<ul>
<li>This applies labels much like the <code>haven</code> version of our data has, which will print out in our plot</li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## create variable for students who plan to graduate from college</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>data_hs_10 <span class="ot">&lt;-</span> data_hs_10 <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">plan_col_grad =</span> <span class="fu">ifelse</span>(x1stuedexpct <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;</span> x1stuedexpct <span class="sc">&lt;</span> <span class="dv">11</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">1</span>,        <span class="co"># if T: 1</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">0</span>),       <span class="co"># if F: 0</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">plan_col_grad =</span> <span class="fu">factor</span>(plan_col_grad,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>)))      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Now that we have our new variable <code>plan_col_grad</code>, we can add it the <code>color</code> aesthetic, <code>aes()</code> in <code>geom_point()</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## scatter</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs_10,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1ses, <span class="at">y =</span> x1txmtscor)) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> plan_col_grad), <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_scatter_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<h4 id="quick-exercise-6">Quick exercise</h4>
<p>Remake the plot so the variables on each axis are flipped</p>
</blockquote>
</section>
<section id="fitted-lines" class="level3">
<h3 data-anchor-id="fitted-lines">Fitted lines</h3>
<ul>
<li>It’s often helpful to plot fitted lines against a scatter plot to help see the underlying trend
<ul>
<li>There are a number of ways to do this with the <code>geom_smooth()</code> function</li>
</ul></li>
</ul>
<section id="linear-fit" class="level4">
<h4 data-anchor-id="linear-fit">Linear fit</h4>
<ul>
<li>Setting <code>method = lm</code> in <code>geom_smooth()</code> will fit a simple straight line of best fit with 95% confidence interval shaded around it.</li>
<li>Since we want the points and the line to share the same <code>x</code> and <code>y</code> aesthetics, let’s put them in the <code>ggplot()</code> base layer</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## add fitted line with linear fit</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs_10, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1ses, <span class="at">y =</span> x1txmtscor)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(plan_col_grad)), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_scatter_3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="loess" class="level4">
<h4 data-anchor-id="loess">Loess</h4>
<ul>
<li>Finally, we can skip trying to adjust a linear line and just fit a <a href="https://en.wikipedia.org/wiki/Local_regression">LOESS</a> curve, which is a smooth line produced by fitting a large number of local polynomial regressions on subsets of the data.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## add fitted line with loess</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_hs_10, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1ses, <span class="at">y =</span> x1txmtscor)) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(plan_col_grad)), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> loess, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/eda_plot_scatter_5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To be clear, these semi-automated lines of best fit should not be used to draw final conclusions about the relationships in your data</li>
<li>You will want to do <strong>much more</strong> analytic work to make sure any correlations you observe aren’t simply spurious and that fitted lines are telling you something useful</li>
<li>That said, fitted lines via <code>ggplot2</code> can be useful when first trying to understand your data or to more clearly show observed trends.</li>
</ul>
</section>
</section>
<section id="line-graph" class="level3">
<h3 data-anchor-id="line-graph">Line graph</h3>
<ul>
<li>When you want to show changes in one variable as a function of another variable
<ul>
<li><em>e.g.</em>, changes in test scores over time</li>
</ul></li>
<li>A line graph is often a good choice.</li>
<li>Since our <code>hsls-small</code> data is cross-sectional, we’ll shift to using our school test score data <code>data_ts</code> from <a href="./04-wrangle-ii.html">Data Wrangling II</a></li>
</ul>
<blockquote class="blockquote">
<p>Quick question: What does cross-sectional mean? What is the opposite of it?</p>
</blockquote>
<ul>
<li>As a reminder, here’s what the schools data looks like</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## show test score data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>data_ts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 5
   school        year  math  read science
   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1 Bend Gate     1980   515   281     808
 2 Bend Gate     1981   503   312     814
 3 Bend Gate     1982   514   316     816
 4 Bend Gate     1983   491   276     793
 5 Bend Gate     1984   502   310     788
 6 Bend Gate     1985   488   280     789
 7 East Heights  1980   501   318     782
 8 East Heights  1981   487   323     813
 9 East Heights  1982   496   294     818
10 East Heights  1983   497   306     795
# ℹ 14 more rows</code></pre>
</div>
</div>
<section id="simple-line-graph" class="level4">
<h4 data-anchor-id="simple-line-graph">Simple Line-Graph</h4>
<ul>
<li>To keep it simple for our first line plot, we’ll filter our plot data to keep only scores for one school
<ul>
<li>Notice how we can do that directly with pipes inside the <code>ggplot()</code> function</li>
</ul></li>
<li>We want to see changes in test scores over time, so we’ll map
<ul>
<li><code>year</code> to the <code>x</code> axis</li>
<li><code>math</code> to the <code>y</code> axis</li>
</ul></li>
<li>To see a line graph, we add <code>geom_line()</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## line graph</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_ts <span class="sc">|&gt;</span> <span class="fu">filter</span>(school <span class="sc">==</span> <span class="st">"Spottsville"</span>),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> math)) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<h4 id="quick-exercise-7">QUICK EXERCISE</h4>
<p>Change the school in <code>filter()</code> to “East Heights” and then “Bend Gate”.</p>
</blockquote>
</section>
<section id="multiple-line-graphs" class="level4">
<h4 data-anchor-id="multiple-line-graphs">Multiple-Line Graphs</h4>
<ul>
<li>Easy enough, but let’s say that we want to add a third dimension — to show math scores for each school in the same plot area. -To do this, we can map a third aesthetic to <code>school</code>. <a href="https://ggplot2.tidyverse.org/reference/geom_path.html#aesthetics">Looking at the help file for <code>geom_line()</code></a>, we see that lines (a version of a path) can take <code>color</code>, which means we can change line color based on a variable.</li>
</ul>
<p>The code below is almost exactly the same as before less two things:</p>
<ol type="1">
<li>We don’t filter <code>data_ts</code> this time, because we want all schools</li>
<li>We add <code>color = school</code> inside <code>aes()</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## line graph for math scores at every school over time</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_ts,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> math, <span class="at">color =</span> school)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>This is nice (though maybe a little messy at the moment) because it allows us to compare math scores across time across schools.</li>
<li>But we have two more test types — reading and science — that we would like to include as well</li>
<li>One approach that will let us add yet another dimension is to use facets</li>
</ul>
</section>
</section>
<section id="facets" class="level3">
<h3 data-anchor-id="facets">Facets</h3>
<ul>
<li><p>With facets, we can put multiple plots together, each showing some subset of the data</p></li>
<li><p>For example, instead of plotting changes in math scores across schools over time on the same plot area (only changing the color), we can use <code>facet_wrap()</code> to give each school its own little plot.</p></li>
<li><p>Compared to the code just above, notice how we’ve removed <code>color = school</code> from <code>aes()</code> and included <code>facet_wrap(~school)</code></p>
<ul>
<li>The tilde (<code>~</code>) works like the tilde in <code>plot(y ~ x)</code> above: it means “plot against or by <em>X</em>”. In this case, we are plotting math test scores over time <em>by</em> each school.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## facet line graph</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_ts,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> math)) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> school) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Is this faceted plot better than the color line plot before it?</p></li>
<li><p>Whether you use the first or the second would largely depend on your specific data and presentation needs.</p></li>
<li><p>Faceting has a clearer advantage, however, when you want to include the fourth level of comparison:</p>
<ol type="1">
<li>scores across</li>
<li>time across</li>
<li>schools</li>
<li>different tests.</li>
</ol></li>
<li><p>To make this comparison, we first need to reshape our data, which is currently long in <code>year</code>, to be long in <code>test</code>, too.</p>
<ul>
<li>As we saw in <a href="./04-wrangle-ii.html">Data Wrangling II</a>, we’ll use <code>pivot_longer()</code> to place each test type in its own column (<code>test</code>) with the <code>score</code> next to it.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## reshape data long</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>data_ts_long <span class="ot">&lt;-</span> data_ts <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"math"</span>,<span class="st">"read"</span>,<span class="st">"science"</span>), <span class="co"># cols to pivot long</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"test"</span>,                 <span class="co"># where col names go</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"score"</span>)               <span class="co"># where col values go</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="do">## show</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>data_ts_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 4
   school     year test    score
   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
 1 Bend Gate  1980 math      515
 2 Bend Gate  1980 read      281
 3 Bend Gate  1980 science   808
 4 Bend Gate  1981 math      503
 5 Bend Gate  1981 read      312
 6 Bend Gate  1981 science   814
 7 Bend Gate  1982 math      514
 8 Bend Gate  1982 read      316
 9 Bend Gate  1982 science   816
10 Bend Gate  1983 math      491
# ℹ 62 more rows</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h4 id="quick-exercise-8">QUICK EXERCISE</h4>
<p>If we have 4 schools, 6 years, and 3 tests, how many observations should <code>data_ts_long</code> have in total? Does it?</p>
</blockquote>
<ul>
<li>With our reshaped data frame, we now reintroduce <code>color</code> into the <code>aes()</code>, this time set to <code>test</code></li>
<li>We make one other change: <code>y = score</code> now, since that’s the column for test scores in our reshaped data</li>
<li>All else is the same.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## facet line graph, with colour = test and ~school</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_ts_long) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> score, <span class="at">color =</span> test)) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>school)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Hmm, currently, each test score is on its own scale, which means this plot isn’t super useful
<ul>
<li>The difference between the types of score is so much greater than the variance within the test scores, we have 3 pretty flat lines</li>
</ul></li>
<li>But maybe what we really want to know is how they’ve changed relative to where they started
<ul>
<li>You can imagine a superintendent who took over in 1980 would be keen to know how scores have changed during their tenure.</li>
</ul></li>
<li>To see this, we need to <em>standardize</em> the test scores
<ul>
<li>Often in statistics, you will mean-standardize a variable
<ul>
<li>Difference between current score and the mean of the score, divided by the standard deviation of the score</li>
</ul></li>
<li>You’ve probably heard of this as a “Z-score” in stats classes</li>
</ul></li>
</ul>
<p><span class="math display">\[
\frac{x_i - \bar{x}}{\sigma}
\]</span></p>
<ul>
<li><p>In simple terms, this puts all scores on the same scale</p></li>
<li><p>To get the graph we want, we are going to do something very similar, but instead of using the mean of the score, we are going to take the score in 1980</p>
<ul>
<li>Therefore, every subsequent year will show the change since 1980, and since it’s standardized, all test scores will be on the same scale</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data_ts_long_std <span class="ot">&lt;-</span> data_ts_long <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(test, school) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score_year_one =</span> <span class="fu">first</span>(score),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>         <span class="do">## note that we're using score_year_one instead of mean(score)</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_std_sch =</span> (score <span class="sc">-</span> score_year_one) <span class="sc">/</span> <span class="fu">sd</span>(score)) <span class="sc">|&gt;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_ts_long_std, <span class="at">n =</span> <span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 6
   school        year test    score score_year_one score_std_sch
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;
 1 Bend Gate     1980 math      515            515          0   
 2 Bend Gate     1980 read      281            281          0   
 3 Bend Gate     1980 science   808            808          0   
 4 East Heights  1980 math      501            501          0   
 5 East Heights  1980 read      318            318          0   
 6 East Heights  1980 science   782            782          0   
 7 Niagara       1980 math      514            514          0   
 8 Niagara       1980 read      292            292          0   
 9 Niagara       1980 science   787            787          0   
10 Spottsville   1980 math      498            498          0   
11 Spottsville   1980 read      288            288          0   
12 Spottsville   1980 science   813            813          0   
13 Bend Gate     1981 math      503            515         -1.07
# ℹ 59 more rows</code></pre>
</div>
</div>
<p>Let’s walk through that code</p>
<ol type="1">
<li>Start with our <code>data_ts_long</code> and assign the output to <code>data_ts_long_std</code></li>
<li>Group the data by both test and school</li>
</ol>
<ul>
<li>This is for us to be able to get a starting point for each test at each school</li>
</ul>
<ol start="3" type="1">
<li>Arrange the data in order of date (it already was, but since we are reliant on that, it’s best to check)</li>
<li>Create a new variable which is the <code>first()</code> score (since we are grouped by test and school, it will do it for each test/school combo)</li>
<li>Create another new variable <code>score_std_sch</code> using the <code>score_year_one</code> as zero</li>
<li>Ungroup the data since we are done with the calculation</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## facet line graph, with colour = test and ~school</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_ts_long_std) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> score_std_sch, <span class="at">color =</span> test)) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>school)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05-viz-i_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And there we have a really informative plot, showing how test scores of all types have changed since 1980 across all four schools. Hopefully this shows that good plots and good data wrangling (and sometimes a little bit of stats) go hand in hand!</p>
</section>
</section>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><a href="./site-attachments/assignments/assignment-04.qmd"><i class="fa-solid fa-question" aria-label="question"></i> Assignment Template</a></p>
<p>Use the <code>hsls-small.dta</code> data set (the version used in this class) make plots that help answer each of the following questions</p>
<ul>
<li>Throughout, you <strong>should</strong> account for missing values by dropping them</li>
<li>Do not worry about axis labels or other visual elements, that is covered next week</li>
</ul>
<blockquote class="blockquote">
<p>Hint: You’re going to need the <a href="https://nces.ed.gov/datalab/onlinecodebook">code book</a> to identify the necessary variables</p>
</blockquote>
<p>Also note, your final project proposals are due this week as well</p>
<section id="question-one" class="level2">
<h2 data-anchor-id="question-one">Question One</h2>
<p><strong>a)</strong> How does student socioeconomic status differ between students who ever attended college and those who did not?</p>
</section>
<section id="question-two" class="level2">
<h2 data-anchor-id="question-two">Question Two</h2>
<p><strong>a)</strong> How do educational expectations (of both students and parents) differ by high school completion status?</p>
<blockquote class="blockquote">
<p>Hint: You will want to borrow some code from last week’s assignment here</p>
</blockquote>
</section>
<section id="question-three" class="level2">
<h2 data-anchor-id="question-three">Question Three</h2>
<p><strong>a)</strong> What is the relationship between student socioeconomic status and math test score?</p>
<!--
Once complete, turn in the .qmd file (must render successfully) and the rendered PDF to Canvas by Tuesday 12:00pm following the lesson.
Assignments will be graded before next lesson on Wednesday in line with the grading policy outlined in the syllabus.
-->
</section>
<section id="submission" class="level2">
<h2 data-anchor-id="submission">Submission</h2>
<p>Once complete turn in the .qmd file (<strong>it must render/run</strong>) and the rendered PDF to Canvas by the due date (usually <strong>Tuesday 12:00pm following the lesson</strong>). Assignments will be graded before next lesson on Wednesday in line with the grading policy outlined in the syllabus.</p>
</section>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/capaldi\.info\/7916");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://capaldi.info">
<p>M.J. Capaldi</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://quarto.org/docs/websites">
<p>Built with Quarto</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ttalVlatt/7916">
      <i class="bi bi-github" role="img" aria-label="Website Code Available Here">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>