<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>III: Maps &amp; Spatial Data (Feat. APIs) – EDH 7916</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./apple-touch-icon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0ec6211309129a110f55943800a981fd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="site-attachments/styles.css">
<meta property="og:title" content="III: Maps &amp; Spatial Data (Feat. APIs) – EDH 7916">
<meta property="og:image" content="https://capaldi.info/7916/apple-touch-icon.png">
<meta property="og:site_name" content="EDH 7916">
<meta property="og:image:height" content="180">
<meta property="og:image:width" content="180">
<meta name="twitter:title" content="III: Maps &amp; Spatial Data (Feat. APIs) – EDH 7916">
<meta name="twitter:image" content="https://capaldi.info/7916/apple-touch-icon.png">
<meta name="twitter:image-height" content="180">
<meta name="twitter:image-width" content="180">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-viz-i.html">Data Visualization</a></li><li class="breadcrumb-item"><a href="./10-viz-iii.html">III: Maps &amp; Spatial Data (Feat. APIs)</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">EDH 7916</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homepage</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-set-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">I: Installing R &amp; RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-set-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II: Reading Data &amp; IPEDS</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-wrangle-i.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">I: Enter the tidyverse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-wrangle-ii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II: Appending, joining, &amp; reshaping data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-wrangle-iii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">III: Working with strings &amp; dates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-wrangle-iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IV: Advanced `tidyverse` &amp; Data Retrieval</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-viz-i.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">I: Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-viz-ii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II: Customization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-viz-iii.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">III: Maps &amp; Spatial Data (Feat. APIs)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-quarto-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reproducible Reports with Quarto</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-pro-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Functions &amp; Loops</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-pro-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bringing it All Together (Feat. Basic Models)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Extra Credit</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-01-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">I: Git &amp; GitHub</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-02-dload-ipeds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II: Skinner’s Download IPEDS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-03-vanilla.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">III: Data Wrangling I Redux: Vanilla R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-04-skinner-phil.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IV: Skinner’s Philosophy of Data Wrangling</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-viz-i.html">Data Visualization</a></li><li class="breadcrumb-item"><a href="./10-viz-iii.html">III: Maps &amp; Spatial Data (Feat. APIs)</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">III: Maps &amp; Spatial Data (Feat. APIs)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Lesson</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Assignment</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><a href="./r-scripts/04-wrangle-ii.R"><i class="fa-solid fa-code" aria-label="code"></i> R</a><a href="./r-scripts/10-viz-iii.R">Code</a></p>
<ul>
<li><p>This is a lesson I originally wrote as a TA for this class with Dr.&nbsp;Skinner in Spring 2023</p>
<ul>
<li><p>It is modeled on a real map-making project I was tasked with in my Graduate Assistantship the previous summer, so is an example of the kind of task you may be asked to do</p>
<ul>
<li><p>As well as making maps, along the way we are also going to touch on</p>
<ul>
<li><p>Using APIs to automatically download data</p></li>
<li><p>Some very fundamental aspects of spatial data</p></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>I will admit, to just makes simple maps (e.g., coloring in states based on a policy adoption), there are simpler ways to go about this</p>
<ul>
<li><p>Instead, the way we are going to cover to involves learning some basics of spatial data and how maps are made</p>
<ul>
<li>This is critical to be able to do any kind of spatial data analysis in the future, such as distance calculations, and helps you make more accurate &amp; intricate maps</li>
</ul></li>
</ul></li>
<li><p>To complete the lesson, we are going to use 3 packages</p>
<ul>
<li><p><code>tidyverse</code> and <code>ggplot</code> to manipulate data and make the map plots</p></li>
<li><p><code>tidycensus</code> to download US Census data tied to spatial data</p></li>
<li><p><code>tigris</code> to download US spatial data and make some spatial transformations</p></li>
<li><p><code>sf</code> to wrangle our spatial data and integrate with <code>ggplot</code></p></li>
</ul></li>
<li><p>We already have <code>tidyverse</code>, but be sure to install the others if you don’t have them already</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lubridate' was built under R version 4.4.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sf' was built under R version 4.4.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidycensus' was built under R version 4.4.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="reading-in-data" class="level2">
<h2 data-anchor-id="reading-in-data">Reading in Data</h2>
<ul>
<li>Spatial data comes in many formats:
<ul>
<li>Shapefiles <code>.shp</code>: A traditional format from ESRI (the makers of ArcGIS)
<ul>
<li>Very widely used, by far the most common format</li>
<li>Comes as a folder containing multiple files with the same name but different extensions
<ul>
<li>The primary file (the one you actually read in) ends in <code>.shp</code> , reading one into R looks something like this
<ul>
<li><code>df_my_map &lt;- read_sf("data/my-map-data/my-map-data")</code></li>
</ul></li>
</ul></li>
<li>Serious limitations for working with attached data, the most annoying of which is the variables can only be 7 characters long</li>
</ul></li>
<li>Other modern, better, but (sadly) rarer formats include
<ul>
<li>GeoDatabase <code>.gdb</code>: A modern format from ESRI</li>
<li>GeoJSON <code>.geojson</code>: A plain text format</li>
<li>GeoPackage <code>.gpkg</code>: An open-source driven single file format</li>
<li>SQL Databses: Many SQL variants can store/handle spatial data
<ul>
<li>The <code>sf</code> package we are going to use is based on <a href="https://postgis.net">PostGIS</a> which is the spatial accompaniment to <a href="https://www.postgresql.org">PostgreSQL</a> open source SQL</li>
</ul></li>
</ul></li>
<li>If you get into spatial data, you’ll want to get familiar with at least Shapefiles at first, then play around with some of the other formats</li>
<li>What’s great about <code>sf</code> is that it can read pretty much any format, and does so in the same way
<ul>
<li><code>read_sf("file/path.extension")</code></li>
</ul></li>
</ul></li>
</ul>
<blockquote class="blockquote">
<h3 id="quick-exercise">Quick Exercise</h3>
<p>There’s so much spatial data out there, using Google see if you can find a Shapefile for something you’re interested in, download it, and read it in to R using <code>read_sf()</code></p>
<p>Hint: US Governments of all levels provide free to use spatial data. If you’re stuck, check out <a href="https://www.arcgis.com/home/group.html?id=6a92eb5098a8485297366e92f148b7d1#overview">Alachua County GIS Portal</a></p>
</blockquote>
<p>For today’s lesson, however, we are going to use an API to directly download our spatial data</p>
</section>
<section id="apis-setting-up-tidycensus" class="level2">
<h2 data-anchor-id="apis-setting-up-tidycensus">APIs &amp; Setting up <code>tidycensus</code></h2>
<ul>
<li>So what exactly is an API?
<ul>
<li>In short, think of it as a way of R going to a website/database and pulling data directly from the server-side or back end, without our having to ever interact with the website directly</li>
<li>This has two main advantages
<ul>
<li>We don’t have to store the large dataset on our computer</li>
<li>Our work becomes instantly more reproducible
<ul>
<li><strong>Note from BS: We avoid point-click at all costs!</strong> We are going to use the API tidycensus today, but all <a href="https://en.wikipedia.org/wiki/API">APIs operate</a> on the same basic idea</li>
</ul></li>
</ul></li>
</ul></li>
<li><code>tidycensus</code> is, in my opinion, one of the easiest APIs to get set up and use in R</li>
<li>Most APIs require that you use some kind of key that identifies you as an authorized user
<ul>
<li>Typically you need to set up the key the first time you use the API, but helpfully, it’s usually possible to store the key on your computer for all future use</li>
<li>Many API keys are free to obtain and use
<ul>
<li>If you were using an API to access a private database such as Google Maps, you might need to pay for your key to have access depending on how much you use it</li>
<li>But because we are using Census data, which is freely available to the public, there’s no charge</li>
</ul></li>
</ul></li>
</ul>
<section id="getting-census-api-key" class="level3">
<h3 data-anchor-id="getting-census-api-key">Getting Census API Key</h3>
<ul>
<li>Getting your Census API key is extremely easy
<ol type="1">
<li><a href="http://api.census.gov/data/key_signup.html">Simply go here</a></li>
<li>Enter your organization name (University of Florida)</li>
<li>Enter your UF email
<ul>
<li>You will quickly receive an email with your API key, which you will need below</li>
</ul></li>
</ol></li>
</ul>
<!-- -->
<ul>
<li>To set up <code>tidycensus</code> for the first time, we first need to set our API key</li>
<li>The <code>tidycensus</code> package makes this much easier than many APIs by having a built-in function that you can use to save your API key to your computer
<ul>
<li>Simply place your API key in the <code>&lt;key&gt;</code> of the code below</li>
<li>The install option means it will save the API key for future use, so you will not need to worry about this step again</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">##' [set API key]</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## you only need to do this once: replace everything between the</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## quotes with the key in the email you received</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">## eg. census_api_key("XXXXXXXXXXXXXXXXXX", install = T)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="st">"&lt;key&gt;"</span>, <span class="at">install =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Now that this is set up, we are ready to start using tidycensus — yay!</li>
</ul>
</section>
</section>
<section id="reading-in-data-with-tidycensus" class="level2">
<h2 data-anchor-id="reading-in-data-with-tidycensus">Reading in data with <code>tidycensus</code></h2>
<ul>
<li>There are multiple main <code>tidycensus</code> functions that you can use to call in data, with each calling data from a different source operated by the <a href="https://www.census.gov">US Census Bureau</a>
<ul>
<li><code>get_acs()</code></li>
<li><code>get_decennial()</code></li>
<li><code>get_estimates()</code></li>
<li><code>get_flows()</code></li>
<li><code>get_pop_groups()</code></li>
<li><code>get_pums()</code></li>
</ul></li>
<li>You can see more information about these on the <a href="https://walker-data.com/tidycensus/reference/index.html">tidycensus reference page</a></li>
</ul>
<!-- -->
<ul>
<li>For today’s lesson we are going to use <code>get_acs()</code>
<ul>
<li>This collects data from the <a href="https://www.census.gov/programs-surveys/acs">American Community Survey</a> (regular sampled surveys of demographic data across the US)</li>
</ul></li>
<li>We are going to assign <code>&lt;-</code> the data we pull down into the object <code>df_census</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">##' [Get ACS Data]</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>df_census <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">"county"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">state =</span> <span class="st">"FL"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">year =</span> <span class="dv">2021</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">variables =</span> <span class="st">"DP02_0065PE"</span>, <span class="co"># Pop &gt;=25 with Bachelors</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">output =</span> <span class="st">"wide"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">geometry =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: • You have not set a Census API key. Users without a key are limited to 500
queries per day and may experience performance limitations.
ℹ For best results, get a Census API key at
http://api.census.gov/data/key_signup.html and then supply the key to the
`census_api_key()` function to use it throughout your tidycensus session.
This warning is displayed once per session.</code></pre>
</div>
</div>
<p>Let’s walk through each element of this command in turn:</p>
<ul>
<li><code>geography = "county"</code>
<ul>
<li>Telling the function to get estimates (and spatial data later) at the county level
<ul>
<li>this could also be <code>"state"</code>, for example, to get state level data</li>
</ul></li>
</ul></li>
<li><code>state = "FL"</code>
<ul>
<li>Telling the function to get data only for the state of Florida
<ul>
<li>You could put a group of states with <code>c()</code>
<ul>
<li>use full state names, or use <a href="https://en.wikipedia.org/wiki/Federal_Information_Processing_Standards">FIPS codes</a> — tidycensus is flexible</li>
</ul></li>
<li>If you want a narrower set of data, you could also add <code>county =</code>, which works in a similar way
<ul>
<li>For example, if you added <code>county = "Alachua"</code>, you would only get county-level data for Alachua County, Florida.</li>
</ul></li>
</ul></li>
</ul></li>
<li><code>year = 2021</code>
<ul>
<li>Telling the function to pull data for the survey year 2021
<ul>
<li>For ACS, this will be the survey set ending in that year</li>
</ul></li>
<li>Keep in mind that some data are not available for every year
<ul>
<li>For example, data from the full decennial census are only available for 2010 or 2020.</li>
</ul></li>
</ul></li>
<li><code>variables = "DP02_0065PE"</code>
<ul>
<li>Telling the function to pull the variable coded <code>"DP02_0065PE"</code>
<ul>
<li>Which is the percentage of the population older than 25 with a Bachelor’s degree</li>
</ul></li>
<li>This is the only tricky part of using <code>tidycensus</code>: understanding Census API’s variable names
<ul>
<li>Let me breakdown what we are calling here:
<ul>
<li><code>DP02_0065</code>
<ul>
<li>This is the main variable code the census uses</li>
<li>You can find these by using the <code>load_variables()</code> command, but doing so creates a massive table in R that is hard to navigate through</li>
<li>An easier way is to go the census API’s list of variables for the dataset you are using, which for the <a href="https://api.census.gov/data/2021/acs/acs5/profile/variables.html">2021 ACS is here</a> (change the years/data sources as needed for other surveys)
<ul>
<li>In here you can <code>crtl-f</code> or <code>cmd-f</code> search for the variable you are looking for</li>
<li>For this variable we could search “bachelor,” which will highlight all the variables that have “bachelor” in the title</li>
<li>Find the variable you want and copy the name.</li>
</ul></li>
</ul></li>
<li><code>PE</code>
<ul>
<li>You will notice there are multiple <code>DP02_0065</code> variables
<ul>
<li>These are the same underlying variable, but in different forms.</li>
</ul></li>
<li>The common endings are <code>E</code> or <code>PE</code>
<ul>
<li>Which stand for Estimate and Percentage Estimate respectively</li>
</ul></li>
<li>For today’s lesson, we want the percentage estimate <code>PE</code>
<ul>
<li>If you want the total count instead, select <code>E</code></li>
</ul></li>
</ul></li>
<li>so we will select <code>DP02_0065PE</code>,
<ul>
<li>This will give us
<ul>
<li><code>DP02_0065PE</code>the percent estimate of Bachelor’s degree attainment for those 25 years old and above</li>
<li><code>DP02_0065PM</code> which is the margin of error for the percentage (hence the <code>M</code> at the end)
<ul>
<li>We don’t need this for our mapping, but it downloads automatically and is useful for some statistical calcualtions</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li><code>output = "wide"</code>
<ul>
<li>Telling it we want the data in a wide format</li>
<li>Think back to <a href="./edh7916/lessons/dw_two.html">Data Wrangling II</a>: wide data means having a separate column for each variable whereas long data would be in two columns, one with the variable name and one with the variable value</li>
<li>For ease of plotting/mapping the variables, we are going to want it in wide format</li>
</ul></li>
<li><code>geometry = TRUE</code>
<ul>
<li>Telling the function we want to download geometry (a kind of spatial data) to go with our census data</li>
<li>By default, this is <code>FALSE</code> , which just downloads the Census data</li>
<li>This saves us having to deal with finding, loading, and joining a shapefile to make our map</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<h3 id="quick-excercise">Quick Excercise</h3>
<p>Using the <a href="https://api.census.gov/data/2021/acs/acs5/profile/variables.html">API variable dictionary we used above</a>, add another variable to your <code>get_acs()</code> using <code>c()</code></p>
</blockquote>
<p>Okay, let see what the top of our new data looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## show header of census data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_census)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -82.57599 ymin: 27.64324 xmax: -80.73292 ymax: 30.14312
Geodetic CRS:  NAD83
  GEOID                    NAME DP02_0065PE DP02_0065PM
1 12095  Orange County, Florida        23.0         0.6
2 12125   Union County, Florida         7.6         2.1
3 12069    Lake County, Florida        16.0         0.9
4 12127 Volusia County, Florida        16.8         0.5
5 12105    Polk County, Florida        14.0         0.5
6 12119  Sumter County, Florida        19.4         1.4
                        geometry
1 MULTIPOLYGON (((-81.65856 2...
2 MULTIPOLYGON (((-82.57599 2...
3 MULTIPOLYGON (((-81.95616 2...
4 MULTIPOLYGON (((-81.6809 29...
5 MULTIPOLYGON (((-82.1062 28...
6 MULTIPOLYGON (((-82.31133 2...</code></pre>
</div>
</div>
<ul>
<li>It looks a bit different than a normal data frame
<ul>
<li>For now, let’s not worry too much about the first few lines which give a summary of the spatial aspects of the our downloaded data</li>
<li>If you look underneath those lines, from <code>GEOID</code> to <code>DP02_0065PM</code>, you’ll see something that looks more like the tibbles we are familiar with</li>
<li>Then, in the last column, we get to our spatial data in the <code>geometry</code> column</li>
<li>If you open <code>df_census</code> in the viewer, it looks like a normal data frame ending with this slightly different column called <code>geometry</code>
<ul>
<li><strong>Note:</strong> I wouldn’t recommend often looking through spatial data in the file viewer as the the spatial data is often huge and can make it slow/laggy
<ul>
<li>If you need to dig into the data that way, use <code>st_drop_geometry()</code> to remove the spatial features, then either print or view it</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## view data frame without geometry data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_census_view <span class="ot">&lt;-</span> df_census <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_census_view)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  GEOID                    NAME DP02_0065PE DP02_0065PM
1 12095  Orange County, Florida        23.0         0.6
2 12125   Union County, Florida         7.6         2.1
3 12069    Lake County, Florida        16.0         0.9
4 12127 Volusia County, Florida        16.8         0.5
5 12105    Polk County, Florida        14.0         0.5
6 12119  Sumter County, Florida        19.4         1.4</code></pre>
</div>
</div>
</section>
<section id="a-very-brief-overview-of-spatial-data" class="level2">
<h2 data-anchor-id="a-very-brief-overview-of-spatial-data">A (Very) Brief Overview of Spatial Data</h2>
<ul>
<li>We do not have time to really get into all the complexities of spatial data in this class, so, unfortunately, it will have to remain a bit of black box for now
<ul>
<li>For those interested in more depth, this is a <a href="https://www.gislounge.com/geodatabases-explored-vector-and-raster-data/">nice intro to the types of spatial data</a></li>
</ul></li>
</ul>
<section id="vectors-vs-rasters" class="level3">
<h3 data-anchor-id="vectors-vs-rasters">Vectors vs Rasters</h3>
<ul>
<li>When looking online for spatial data, you might see how spatial data can be either in vector or raster format
<ul>
<li>For our purpose today (and most of the time outside certain use cases) everything is going to be vector
<ul>
<li>Similar to a vector in R (a column or list of data)
<ul>
<li>Just a collection of data points that represent something
<ul>
<li>Only this time it’s representing something spatial</li>
<li>Think of it like instructions to draw a shape</li>
</ul></li>
</ul></li>
</ul></li>
<li>Raster data, on the other hand, is a grid with information assigned to each square
<ul>
<li>Think of it like a big paint-by-numbers grid and the shape you see is where some squares are filled in</li>
<li>Commonly used for satellite imagery analysis
<ul>
<li>Doesn’t scale well for mapping</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="spatial-data-vectors" class="level3">
<h3 data-anchor-id="spatial-data-vectors">Spatial Data Vectors</h3>
<ul>
<li>No matter the format, working with spatial data involves two things
<ul>
<li>The data itself (the numbers in the geometry column)</li>
<li>How that data is projected (the CRS, which we will cover below)</li>
</ul></li>
<li>The data in a spatial vector come in three primary formats
<ul>
<li>points (think dots on a map)</li>
<li>lines (think a line connecting two points on a map)</li>
<li>polygons (think a collection of lines on a map that create a closed shape)
<ul>
<li>You can also have multi-polygons or multi-lines, which are just multiple shapes that represent that observation</li>
</ul></li>
<li>Ultimately though, it all comes back to point data, everything else is made up of those</li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/vector_data_types-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/vector_data_types-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/vector_data_types-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>In this lesson we are going to use both point and polygon data (you won’t see line data as often in the wild)</li>
<li>If this sounds complicated, fear not! It is much simpler than it sounds right now!</li>
</ul>
</section>
<section id="coordinate-reference-systems-crs" class="level3">
<h3 data-anchor-id="coordinate-reference-systems-crs">Coordinate Reference Systems (CRS)</h3>
<ul>
<li>For purposes of this lesson, the only internal workings of spatial data we need to be aware of is something called the Coordinate Reference System or CRS
<ul>
<li>Our earth is not flat, but rather is a curved three-dimensional object (<strong>Note from Ben: <a href="https://en.wikipedia.org/wiki/Modern_flat_Earth_beliefs">this is most likely true</a></strong>)</li>
<li>Since we don’t want to carry around globes, we take this 3D object and squish it into two dimensions on a map</li>
<li>This process necessarily involves some kind of transformation, compromise, or projection</li>
</ul></li>
<li>In a nutshell, this is a very simplified explanation of what a CRS decides
<ul>
<li>it’s how we are deciding to twist, pull, squish a 3D Earth surface into a flat surface</li>
<li>Turns out this matters a lot depending on what purpose your map is for
<ul>
<li>Do you want your results to have the correct areas?</li>
<li>Or maybe correct distances?</li>
<li>Or maybe straight lines of bearing (particularly important if you are <a href="https://en.wikipedia.org/wiki/Mercator_projection">sailing and don’t want those trips to take any longer than necessary</a>)?</li>
</ul></li>
<li>There are, as you can see by <a href="https://spatialreference.org/ref/epsg/">this list</a>, also a lot of localized CRS projections
<ul>
<li>The more local a projection, the less it has to twist, pull, stretch, or squish data
<ul>
<li>This means it can be more accurate, with less compromise, for that specific area
<ul>
<li>But if you use a localized projection for the wrong area, you’re going to be way off</li>
<li>If you’re doing spatial analysis (distance calculations etc.) it’s best to the use most local projection you can that is still valid for your whole study area</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li>Here’s a (somewhat old) pop culture look at this issue from one of my favorite shows…</li>
</ul>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/vVX-PrBRtTY" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<ul>
<li>This is a relatively complicated process we are not going to go into here. If you’re interested here’s a <a href="https://docs.qgis.org/2.8/en/docs/gentle_gis_introduction/coordinate_reference_systems.html">nice introduction to CRS</a> by QGIS</li>
<li>For our class we are going to use the CRS EPSG 4326
<ul>
<li>In essence a projection that
<ul>
<li>Makes east/west run straight left/right</li>
<li>Makes north/south run straight up/down</li>
<li>Keeps all latitude and longitude degrees equally spaced apart (much to the dismay of our friends from the <a href="https://westwing.fandom.com/wiki/Organization_of_Cartographers_for_Social_Equality">OCSE</a>)</li>
</ul></li>
<li>All different CRS have their advantages and disadvantages
<ul>
<li>This is nice and simple for quick descriptive maps, but distorts shapes in ways that might be harmful, particularly if you are going to do any distance calculations, etc.</li>
</ul></li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p><strong>Note from Ben:</strong> If you are going to do spatial work in education research (other than just making maps for display), you <strong>really</strong> need to know what your projection is doing. Even if you are just making maps for display, some projections are, IMNSHO, more aesthetically pleasing that others in different situations.</p>
</blockquote>
<ul>
<li>Keep an eye out for <code>crs = 4326</code> as we go through some examples plotting spatial data below.</li>
</ul>
</section>
<section id="how-r-stores-all-this-spatial-data" class="level3">
<h3 data-anchor-id="how-r-stores-all-this-spatial-data">How R Stores All This Spatial Data</h3>
<ul>
<li>As we saw above, there is a column on the end of our data called <code>geometry</code>
<ul>
<li>This is not technically a column like we are used to
<ul>
<li>E.g., you can’t <code>join(df_one, df_two, by = geometry)</code> or <code>filter(geometry == x)</code> like we do with other variables in our data frames
<ul>
<li>If you want to spatially join or filter data, you have to use
<ul>
<li><code>st_filter()</code></li>
<li><code>st_join()</code></li>
</ul></li>
<li>Using these is bit beyond where we will get in this class, but, note this for future work, it can be really useful</li>
</ul></li>
</ul></li>
<li>Instead, think of it as a special attachment R places on each observation</li>
</ul></li>
</ul>
</section>
<section id="summary-of-spatial-data-basics" class="level3">
<h3 data-anchor-id="summary-of-spatial-data-basics">Summary of Spatial Data Basics</h3>
<p>In short, what you need to know about spatial data for this lesson is this:</p>
<ul>
<li>R stores spatial data in something called <code>geometry</code> attached to each observation/row
<ul>
<li>To handle these spatial aspects of the data, you can’t just <code>filter()</code> it like normal; instead you have to use functions from a spatial data package such as <code>sf</code> or <code>tigris</code></li>
</ul></li>
<li>The CRS (coordinate reference system) is how we choose to account for the earth being curved
<ul>
<li>Crucial for mapping is that everything we use on the plot is using the same CRS</li>
<li>Using <code>crs = 4326</code> will give a nice simple flat projection
<ul>
<li>This projection has drawbacks, but is easy to work with and so is what we will use for now</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="lets-make-a-map-finally" class="level2">
<h2 data-anchor-id="lets-make-a-map-finally">Let’s Make a Map (finally)!</h2>
<p>If we have made it this far, things are about to get much more interesting and hands-on!</p>
<ul>
<li>We are going to make an education-focused map based on template I used for a real consulting project Summer 2022 as part of my GA-ship</li>
<li>This template is really adaptable for a lot the kind of maps we might want educational research and reports</li>
<li>So let’s get started!
<ul>
<li>We are going to have two layers
<ul>
<li>A base map with the census data we already downloaded</li>
<li>A layer of points on top representing colleges</li>
</ul></li>
</ul></li>
</ul>
<section id="layer-one-base-map" class="level3">
<h3 data-anchor-id="layer-one-base-map">Layer One: Base Map</h3>
<ul>
<li>Before we plot anything, particularly since we are going to have multiple layers, we want to check our CRS</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------------------------------------</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">##' [Making a map (finally)]</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------------------------------------</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">##' [Layer one: base map]</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="do">## show CRS for dataframe</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(df_census)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 
  wkt:
GEOGCRS["NAD83",
    DATUM["North American Datum 1983",
        ELLIPSOID["GRS 1980",6378137,298.257222101,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4269]]</code></pre>
</div>
</div>
<p>That isn’t our simple flat EPSG 4326, so we are going to <code>st_transform()</code> to set that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## transform the CRS to 4326</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df_census <span class="ot">&lt;-</span> df_census <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can check again…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## show CRS again; notice how it changed from NAD93 to EPSG:4326</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(df_census) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    ENSEMBLE["World Geodetic System 1984 ensemble",
        MEMBER["World Geodetic System 1984 (Transit)"],
        MEMBER["World Geodetic System 1984 (G730)"],
        MEMBER["World Geodetic System 1984 (G873)"],
        MEMBER["World Geodetic System 1984 (G1150)"],
        MEMBER["World Geodetic System 1984 (G1674)"],
        MEMBER["World Geodetic System 1984 (G1762)"],
        MEMBER["World Geodetic System 1984 (G2139)"],
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ENSEMBLEACCURACY[2.0]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
<p>Looks good!</p>
<ul>
<li>Okay, with our CRS now set, let’s plot our base map.
<ul>
<li>We actually use the familiar <code>ggplot()</code> to make our maps because there is a special <code>geom_*</code> that works with spatial data
<ul>
<li><code>geom_sf()</code></li>
<li>Everything works in a similar way to our normal plots, so this should be familiar. Luckily all the tricky spatial aspects are handled by ggplot for us.</li>
</ul></li>
</ul></li>
<li>The below code will make our base map, and store in an object called <code>base_map</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## create base map</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>base_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> df_census,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> DP02_0065PE),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="fu">str_wrap</span>(<span class="st">"Percent Population with Bachelor's"</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#a6b5c0"</span>, <span class="at">high =</span> <span class="st">"#00254d"</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s go through each line of the <code>geom_sf()</code> as we did for <code>get_acs()</code> above:</p>
<ul>
<li><code>data = df_census</code>
<ul>
<li>All we need to do take make our spatial plot is call a data frame with a geometry attachment. <code>geom_sf()</code> will handle how to plot that for us.</li>
</ul></li>
<li><code>aes(fill = DP02_0065PE)</code>
<ul>
<li>Much like we would with a box plot, we are simply telling ggplot to fill the shapes (in our case, Florida’s counties) based on that variable</li>
<li>So here we are filling Florida’s counties based on the percent of the population over 25 with a Bachelor’s degree (the variable we chose from tidycensus)</li>
</ul></li>
<li><code>color = "black"</code>
<ul>
<li>Remember since this is outside the <code>aes()</code> argument it will applied consistenly across the plot. We are telling it to make all the lines black.</li>
</ul></li>
<li><code>size = 0.1</code>
<ul>
<li>Similarly, we are telling to make the lines 0.1 thickness (thinner than the default)</li>
</ul></li>
</ul>
<p>Then we have added two visual alterations like we covered in the <a href="./edh7916/lessons/plotting_ii.html">second plotting lesson</a>. For a quick reminder:</p>
<ul>
<li><code>labs(fill = str_wrap("Percent Population with Bachelor's", 20))</code>
<ul>
<li>Is saying to give the legend for <code>fill</code> this title
<ul>
<li>The new function, <code>str_wrap()</code> says to make a newline (wrap) when there are more than 20 characters</li>
</ul></li>
</ul></li>
<li><code>scale_fill_gradient(low = "#a6b5c0", high = "#00254d")</code>
<ul>
<li>Is telling <code>fill</code> with a color gradient starting at with light slate blue and finishing with a dark slate blue
<ul>
<li>Instead of color names, we’re using <a href="https://en.wikipedia.org/wiki/Web_colors">hex color codes</a></li>
</ul></li>
</ul></li>
<li>Now, let’s call our <code>base_map</code> object to see what this looks like</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## call base map by itself</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>base_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/base_map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Woohoo! We have made a map!</p>
<section id="data-viz-ii-throwback" class="level4">
<h4>Data Viz II Throwback</h4>
<ul>
<li>Remember in the <a href="./06-viz-ii.html">second lesson on data visualization</a> we spent the entire time customizing the appearance of a single plot?</li>
<li><code>geom_sf()</code> is just another type of <code>ggplot</code>, so, we can use all the same things we learned</li>
</ul>
<blockquote class="blockquote">
<h3 id="quick-exercise-1" data-anchor-id="data-viz-ii-throwback">Quick Exercise</h3>
<ol type="1">
<li>Play around with the <code>scale_fill_gradient</code> to use your favorite color</li>
<li>Play around with the <code>theme</code> argument, can you find the theme that gets rid of all grid lines?</li>
</ol>
</blockquote>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/base_map_qe-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now we are going to make it more interesting with one more layer…</p>
</section>
</section>
<section id="layer-two-institution-points" class="level3">
<h3 data-anchor-id="layer-two-institution-points">Layer Two: Institution Points</h3>
<ul>
<li>A lot of education data comes with a latitude and longitude for the institution</li>
<li>Today we are going to use IPEDS, but you can certainly get these for K-12 schools and a whole lot more besides
<ul>
<li>Caution: I have noticed in my own work that IPEDS coordinates are not always the most consistent (an issue we have seen with other IPEDS data through the course)
<ul>
<li>If you’re wanting to do something that where precision really matters the Department of Homeland Security has <a href="https://hifld-geoplatform.hub.arcgis.com">open data</a> that, in my experience, is more consistent with Google Maps locations
<ul>
<li>It also provides polygons of larger college campuses rather than just coordinate points, which might be useful for some of your research (I’m using them at the moment)</li>
</ul></li>
</ul></li>
</ul></li>
<li>For today, we are going to read in some library data from IPEDS that I cleaned and merged earlier
<ul>
<li>This is a combination of <code>HD</code> and <code>AL</code> data files for 2021</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="do">##' [Layer Two: Institutions]</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------------------</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="do">## read in IPEDS data</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>df_ipeds <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/mapping-api-data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at our data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## show IPEDS data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_ipeds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 78
  UNITID INSTNM CONTROL ICLEVEL STABBR  FIPS COUNTYNM COUNTYCD LATITUDE LONGITUD
   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 100654 Alaba…       1       1 AL         1 Madison…     1089     34.8    -86.6
2 100663 Unive…       1       1 AL         1 Jeffers…     1073     33.5    -86.8
3 100690 Amrid…       2       1 AL         1 Montgom…     1101     32.4    -86.2
4 100706 Unive…       1       1 AL         1 Madison…     1089     34.7    -86.6
5 100724 Alaba…       1       1 AL         1 Montgom…     1101     32.4    -86.3
6 100751 The U…       1       1 AL         1 Tuscalo…     1125     33.2    -87.5
# ℹ 68 more variables: LEXP100K &lt;dbl&gt;, LCOLELYN &lt;dbl&gt;, XLPBOOKS &lt;chr&gt;,
#   LPBOOKS &lt;dbl&gt;, XLEBOOKS &lt;chr&gt;, LEBOOKS &lt;dbl&gt;, XLEDATAB &lt;chr&gt;,
#   LEDATAB &lt;dbl&gt;, XLPMEDIA &lt;chr&gt;, LPMEDIA &lt;dbl&gt;, XLEMEDIA &lt;chr&gt;,
#   LEMEDIA &lt;dbl&gt;, XLPSERIA &lt;chr&gt;, LPSERIA &lt;dbl&gt;, XLESERIA &lt;chr&gt;,
#   LESERIA &lt;dbl&gt;, XLPCOLLC &lt;chr&gt;, LPCLLCT &lt;dbl&gt;, XLECOLLC &lt;chr&gt;,
#   LECLLCT &lt;dbl&gt;, XLTCLLCT &lt;chr&gt;, LTCLLCT &lt;dbl&gt;, XLPCRCLT &lt;chr&gt;,
#   LPCRCLT &lt;dbl&gt;, XLECRCLT &lt;chr&gt;, LECRCLT &lt;dbl&gt;, XLTCRCLT &lt;chr&gt;, …</code></pre>
</div>
</div>
<ul>
<li>We see a normal data frame for colleges with bunch of variables
<ul>
<li>Reminder: You can use <a href="https://nces.ed.gov/ipeds/datacenter/DataFiles.aspx?year=2021&amp;sid=8eaf0451-12a1-43d9-a9df-79bcc9c9eba5&amp;rtid=7">IPEDS dictionaries</a> to unpack unknown variable names</li>
</ul></li>
<li>Most importantly for right now, we see latitude and longitude
<ul>
<li>Latitude and longitude represent something spatial, but they’re not quite spatial data like R knows</li>
<li>Let’s change that!</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## convert coordinates columns into a true geometry column; this is</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">## much more reliable than simply plotting them as geom_points as it</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ensures the CRS matches etc.</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>df_ipeds <span class="ot">&lt;-</span> df_ipeds <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUD"</span>, <span class="st">"LATITUDE"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Above we call <code>st_as_sf()</code>
<ul>
<li>then tell it the coordinates, <code>coords =</code>, are in columns name <code>LONGITUD</code> and <code>LATITUDE</code></li>
<li>The order these go is very important (and changes between some systems) but for <code>sf</code> it’s longitude then latitude as we follow the usual <code>x, y</code> order
<ul>
<li>Longitude tells you were you are east/west on the globe, it translates to the <code>x</code> axis</li>
<li>Latitude gives you north/south direction, it translates to the <code>y</code> axis</li>
</ul></li>
</ul></li>
<li>If we look at our data again, we are going to see that spatial summary again as R has attached some point geometry to our college data based on the coordinates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## show IPEDS data again</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_ipeds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 76 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -87.54598 ymin: 32.36261 xmax: -86.17401 ymax: 34.78337
CRS:           NA
# A tibble: 6 × 77
  UNITID INSTNM CONTROL ICLEVEL STABBR  FIPS COUNTYNM COUNTYCD LEXP100K LCOLELYN
   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 100654 Alaba…       1       1 AL         1 Madison…     1089        1        2
2 100663 Unive…       1       1 AL         1 Jeffers…     1073        1        2
3 100690 Amrid…       2       1 AL         1 Montgom…     1101        1        2
4 100706 Unive…       1       1 AL         1 Madison…     1089        1        2
5 100724 Alaba…       1       1 AL         1 Montgom…     1101        1        2
6 100751 The U…       1       1 AL         1 Tuscalo…     1125        1        2
# ℹ 67 more variables: XLPBOOKS &lt;chr&gt;, LPBOOKS &lt;dbl&gt;, XLEBOOKS &lt;chr&gt;,
#   LEBOOKS &lt;dbl&gt;, XLEDATAB &lt;chr&gt;, LEDATAB &lt;dbl&gt;, XLPMEDIA &lt;chr&gt;,
#   LPMEDIA &lt;dbl&gt;, XLEMEDIA &lt;chr&gt;, LEMEDIA &lt;dbl&gt;, XLPSERIA &lt;chr&gt;,
#   LPSERIA &lt;dbl&gt;, XLESERIA &lt;chr&gt;, LESERIA &lt;dbl&gt;, XLPCOLLC &lt;chr&gt;,
#   LPCLLCT &lt;dbl&gt;, XLECOLLC &lt;chr&gt;, LECLLCT &lt;dbl&gt;, XLTCLLCT &lt;chr&gt;,
#   LTCLLCT &lt;dbl&gt;, XLPCRCLT &lt;chr&gt;, LPCRCLT &lt;dbl&gt;, XLECRCLT &lt;chr&gt;,
#   LECRCLT &lt;dbl&gt;, XLTCRCLT &lt;chr&gt;, LTCRCLT &lt;dbl&gt;, LILLDYN &lt;dbl&gt;, …</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h3 id="quick-question">Quick Question</h3>
<p>Something’s not quite right, can you tell me what?</p>
<p>Hint: It’s something we just talked about being very important</p>
</blockquote>
<ul>
<li>This means R will not be able to turn that spatial data into a map
<ul>
<li>Basically, R knows we have spatial data, but it doesn’t know how we want to put it onto a 2D surface (how to project it)</li>
</ul></li>
<li>To be sure, let’s check the it directly</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## check CRS for IPEDS data</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(df_ipeds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System: NA</code></pre>
</div>
</div>
<p>Yep, <code>NA</code>… Luckily the fix for this is simple</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## add CRS to our IPEDS data</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>df_ipeds <span class="ot">&lt;-</span> df_ipeds <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="dv">4326</span>) <span class="co"># When you first add coordinates to geometry, it doesn't know</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                   <span class="co"># what CRS to use, so we set to 4326 to match our base map data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay, let’s have another look…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## check CRS of IPEDS data again</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(df_ipeds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    ENSEMBLE["World Geodetic System 1984 ensemble",
        MEMBER["World Geodetic System 1984 (Transit)"],
        MEMBER["World Geodetic System 1984 (G730)"],
        MEMBER["World Geodetic System 1984 (G873)"],
        MEMBER["World Geodetic System 1984 (G1150)"],
        MEMBER["World Geodetic System 1984 (G1674)"],
        MEMBER["World Geodetic System 1984 (G1762)"],
        MEMBER["World Geodetic System 1984 (G2139)"],
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ENSEMBLEACCURACY[2.0]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
<p>And we see we have our nice CRS back!</p>
<ul>
<li>Okay, now the hard work is done, we just need to call our <code>base_map</code>, add a layer representing the colleges as points, and store it into a new object <code>point_map</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>point_map <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> df_ipeds <span class="sc">|&gt;</span> <span class="fu">filter</span>(FIPS <span class="sc">==</span> <span class="dv">12</span>), <span class="co"># Only want to plot colleges in FL</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">size =</span> LPBOOKS),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">shape =</span> <span class="dv">23</span>, <span class="co"># Get the diamond shape which stands out nicely on the map</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>, <span class="co"># This shape has a fill and color for the outline</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="co"># FYI 21 is a circle with both fill and color</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">size =</span> <span class="st">"Number of Books in Library"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we have done all lesson, we can take a quick look through our second <code>geom_sf()</code> function line by line:</p>
<ul>
<li><code>data = df_ipeds |&gt; filter(FIPS == 12)</code>:
<ul>
<li>For this layer we are using our <code>df_ipeds</code> data, which covers the country, but since our base map is Florida, we only want colleges located in the Sunshine State (which is FIPS code 12).</li>
</ul></li>
<li><code>aes(size = LPBOOKS)</code>
<ul>
<li>Is saying we want to change the size of point based on <code>LPBOOKS</code>, which is the total number of books in the college’s library collection. More books, bigger point!</li>
</ul></li>
<li><code>shape = 23</code>
<ul>
<li>This is purely aesthetic, instead of usual circles, this is a diamond shape</li>
</ul></li>
<li><code>fill = "white"</code> and <code>color = "black"</code>
<ul>
<li>Change the inside of the diamonds white and the lines around the edge to black
<ul>
<li>Note, this shape (another others) have an inside to <code>fill</code> and a border to <code>color</code>, the basic point shape only has <code>color</code></li>
</ul></li>
</ul></li>
<li><code>alpha = 0.5</code>
<ul>
<li>Is outside the <code>aes()</code> so we are making it all 50% transparent.</li>
</ul></li>
<li><code>labs(size = "Number of Books in Library")</code>
<ul>
<li>To change the legend title to “Number of Books in Library”</li>
</ul></li>
</ul>
<p>Phew! Last thing, let’s call our new <code>point_map</code> object and take a look at what we created!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## show new map</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>point_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/point_map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>There we go!</li>
<li>We now have a map that shows us county bachelor’s degree attainment and the number of books in a college’s library.
<ul>
<li>If you notice, UF has most books out of all Florida colleges, Go Gators!</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<h3 id="quick-exercise-2">Quick Exercise</h3>
<ol type="1">
<li>Play around the with <code>shape</code> argument and see what other options there are</li>
<li>Time permitting: See if you can get rid of the scientific numbering (e.g., <code>1e+06</code>) so it looks the plot below
<ul>
<li>There’s a few ways, Google and StackOverflow have some helpful answers</li>
</ul></li>
</ol>
</blockquote>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/point_map_fix-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Obviously, this may not be the most useful map in the world, but the template is very adaptable to a lot of educational situations
<ul>
<li>Using <code>tidycensus</code> we can swap out the base map geography to have most common US geographies and/or swap out any variable available in from the Census Bureau
<ul>
<li>You will also see below a way of getting shapes without Census data using <code>tigris</code></li>
<li>See the example on school districts below</li>
</ul></li>
<li>Equally, we can swap out the point data to represent anything we have coordinate points for and change the aesthetics to represent any data we have for those points</li>
</ul></li>
</ul>
</section>
</section>
<section id="supplemental-material-us-transformations-tigris-basics" class="level2">
<h2 data-anchor-id="supplemental-material-us-transformations-tigris-basics">Supplemental Material: US transformations &amp; <code>tigris</code> basics</h2>
<ul>
<li>For the sake of time, I left this until the end as we don’t need it for the assignment. But it may be useful if you are looking to make any maps in your final assignment or the future.</li>
</ul>
<p><code>tigris</code> is a package that offers a direct way of downloading US spatial data that is not tied to census data.</p>
<ul>
<li>Note: it’s actually used by tidycensus behind the scenes to get your spatial data</li>
<li>If you get spatial data from tigris it won’t come with any additional data to plot per say, but it comes with identifying variables you could use to pair up with external data using something like <code>left_join()</code></li>
</ul>
<section id="mapping-school-districts" class="level3">
<h3 data-anchor-id="mapping-school-districts">Mapping School Districts</h3>
<ul>
<li>If we wanted to plot Census data about the population in these school districts we could get these from <code>tidycensus</code> with <code>geography = "school district (unified)"</code></li>
<li>If instead we have school district data we want to plot, or we are only interested in the boundary, we might want to download the spatial data for school districts directly
<ul>
<li>In that case, it might be easier to use tigris directly to get the blank shapefiles.</li>
<li>The function names for tigris are really simple.
<ul>
<li><code>school_districts()</code> for example retrieves a shapefile for US school districts</li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> df_school_dist_tx,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>You’ll notice we actually left <code>aes()</code> blank, as <code>geom_sf()</code> will automatically make the spatial elements for us and right now we have no additional info to add to plot elements like <code>fill</code></li>
<li>There is one new argument in there
<ul>
<li><code>cb = TRUE</code>
<ul>
<li>Stands for cartographic boundary, basically, a less detailed line that makes for faster and easier mapping
<ul>
<li>If the border detail was really important to your analysis, you might want to set to false, but for mapping it’s usually the best option</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="states-and-crs-transformations" class="level2">
<h2 data-anchor-id="states-and-crs-transformations">50 States and CRS Transformations</h2>
<ul>
<li>Finally, we are going to look at how CRS projections changes national maps
<ul>
<li>First, we need to download some basic spatial data for the 50 states
<ul>
<li>Like I said before, <code>tigris</code> function names are really simple
<ul>
<li><code>states()</code> downloads spatial data for the states
<ul>
<li>Similarly to <code>cb = TRUE</code> we discussed above <code>resolution = "20m"</code> sacrifices a little detail for speed and efficiency for mapping</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Like we did before, let’s take a peak at our newly downloaded data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## look at head of state data</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -179.1743 ymin: 24.49813 xmax: 179.7739 ymax: 71.35256
Geodetic CRS:  NAD83
  STATEFP  STATENS    AFFGEOID GEOID STUSPS      NAME LSAD        ALAND
1      22 01629543 0400000US22    22     LA Louisiana   00 1.119153e+11
2      02 01785533 0400000US02    02     AK    Alaska   00 1.478943e+12
3      24 01714934 0400000US24    24     MD  Maryland   00 2.515199e+10
4      55 01779806 0400000US55    55     WI Wisconsin   00 1.402923e+11
5      12 00294478 0400000US12    12     FL   Florida   00 1.389617e+11
6      13 01705317 0400000US13    13     GA   Georgia   00 1.494866e+11
        AWATER                       geometry
1  23736382213 MULTIPOLYGON (((-94.04305 3...
2 245378425142 MULTIPOLYGON (((179.4813 51...
3   6979074857 MULTIPOLYGON (((-76.04621 3...
4  29343646672 MULTIPOLYGON (((-86.93428 4...
5  45972570361 MULTIPOLYGON (((-81.81169 2...
6   4418360134 MULTIPOLYGON (((-85.60516 3...</code></pre>
</div>
</div>
<ul>
<li>Similar to before, we have
<ul>
<li>A spatial summary at the top</li>
<li>A set of normal looking columns with different ID codes and names</li>
<li>An attached geometry for each row</li>
</ul></li>
<li>If we simply plot this with no aesthetics, we get the outline of all states, but there is something about it that makes it less ideal for a quick data visualization…</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## quick plot of states</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> df_st,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>) <span class="co"># keep the lines thin, speeds up plotting processing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/big_us_map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>As we can see, while the map is geographically accurate, there is a lot of open ocean on the map due to the geographic structure of the US
<ul>
<li>The tail of Alaska crosses the 180 degree longitude line, so it wraps to the other side of the map</li>
</ul></li>
<li>Often when we see maps of the US, such as on election night, Alaska and Hawaii are moved to make it easier to read
<ul>
<li>Tigris offers an easy way of doing this
<ul>
<li><code>shift_geometry()</code>
<ul>
<li>should work on any spatial data with Alaska, Hawaii, and Puerto Rico</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## replotting with shifted Hawaii and Alaska</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">shift_geometry</span>(df_st),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>) <span class="co"># keep the lines thin, speeds up plotting processing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/us_map_shift-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Although not always a good idea, if you’re looking to plot the 50 states in an easy-to-read manner, this can be a really useful tool
<ul>
<li>Note: it does not move other U.S. territories like Guam by default, so you may have colleges and schools out there you need to deal with</li>
<li>Note: this can re-project your data, so you need to make sure your CRS is what you want after this (as we will do in our final examples)</li>
</ul></li>
<li><strong>Never do spatial analysis on data you’ve done this to, it will be severely off</strong>
<ul>
<li>I recommend only ever using it inside <code>geom_sf()</code>
<ul>
<li>This way you never change your data
<ul>
<li>You don’t want to accidentally say Hawaii is closer to Austin than Oklahoma City is…</li>
</ul></li>
</ul></li>
</ul></li>
<li>Finally, to re-illustrate what a CRS does, let’s plot this two more times
<ul>
<li>First, putting it onto our simple EPSG 4326 CRS from earlier</li>
<li>Then, using the Peters Projection referenced in the video clip at the start of class</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## change CRS to what we used for earlier map</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">shift_geometry</span>(df_st) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="dv">4326</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/us_map_crs_change-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>See how the line are now a perfect grid, but the shapes of states (look at Montana) are a little different?
<ul>
<li>That’s the power of a CRS!</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<h3 id="quick-exercise-3">Quick Exercise</h3>
<ul>
<li>Pick a different projection from the <a href="https://epsg.io/?q=">list of EPSG projections</a> and see what changes
<ul>
<li>Perhaps try a projection for a different part of the world
<ul>
<li>Below I tried <a href="https://epsg.io/6684">EPSG 6684</a> for Tokyo, Japan</li>
</ul></li>
</ul></li>
</ul>
</blockquote>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/us_map_wrong_crs-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Finally, let’s please the <a href="https://westwing.fandom.com/wiki/Organization_of_Cartographers_for_Social_Equality">Organization of Cartographers for Social Equality</a> and look at the Peters projection
<ul>
<li><strong>Note</strong>: while this projection is great for showing comparably accurate area across the globe, it does that by other trade offs not acknowledged by Dr.&nbsp;Fallow from OCSE</li>
<li>No projection is universally better, each is better for the <strong>task it was designed for</strong>
<ul>
<li>That’s the key with CRS, find the best one for the task you’re doing.</li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">## change CRS to requirements for Peters projection</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="do">## h/t https://gis.stackexchange.com/questions/194295/getting-borders-as-svg-using-peters-projection</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>pp_crs <span class="ot">&lt;-</span> <span class="st">"+proj=cea +lon_0=0 +x_0=0 +y_0=0 +lat_ts=45 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">shift_geometry</span>(df_st) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(pp_crs),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10-viz-iii_files/figure-html/ocse_peters-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>See how to the gap between 45 and 50 degrees north is much smaller than between 20 and 25 degrees north?
<ul>
<li>That’s the projection at work
<ul>
<li>Think about how this reflects how the globe is shaped and how that affects area (the focus of the Peters projection map)</li>
</ul></li>
</ul></li>
</ul>
</section>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><a href="./site-attachments/assignments/assignment-10.qmd"><i class="fa-solid fa-question" aria-label="question"></i> Assignment Template</a></p>
<p>For this week’s assignment, you have two options, make another map similar to the one we made in class, or, make a map you can use in your final project</p>
<section id="option-one" class="level2">
<h2 data-anchor-id="option-one">Option One</h2>
<p>Using the <code>tidycensus</code> package and code from this lesson, make a different point map following the instructions below:</p>
<ol type="1">
<li>Modify the <code>tidycensus</code> code to download data for a different geography <strong>and</strong> a different variable</li>
<li>Make a new base map</li>
<li>Use the same academic libraries IPEDS data (or another IPEDS file if you want) to plot points on your new base map that change <code>aes()</code> based on a new variable</li>
</ol>
</section>
<section id="option-two" class="level2">
<h2 data-anchor-id="option-two">Option Two</h2>
<p>Using data from your final project (plus <code>tidycensus</code> and/or <code>tigris</code> as needed) make a map following the guidance from the lesson. This will take a bit more time now, but, if it makes sense for your final project it might save you time later.</p>
<ul>
<li>Note: It still needs to be a <code>geom_sf()</code></li>
</ul>
<blockquote class="blockquote">
<p>Hint: The main challenge will be working out how to either convert you data to spatial data or merge it with existing spatial data</p>
</blockquote>
<!--
Once complete, turn in the .qmd file (must render successfully) to Canvas by Tuesday 12:00pm following the lesson.
Assignments will be graded before next lesson on Wednesday in line with the grading policy outlined in the syllabus.
-->
</section>
<section id="submission" class="level2">
<h2 data-anchor-id="submission">Submission</h2>
<p>Once complete turn in the .qmd file (<strong>it must render/run</strong>) to Canvas by the due date (usually <strong>Tuesday 12:00pm following the lesson</strong>). Assignments will be graded before next lesson on Wednesday in line with the grading policy outlined in the syllabus.</p>
</section>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/capaldi\.info\/7916");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://capaldi.info">
<p>M.J. Capaldi</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://quarto.org/docs/websites">
<p>Built with Quarto</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ttalVlatt/7916">
      <i class="bi bi-github" role="img" aria-label="Website Code Available Here">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>